{% import 'macros/rec-macro.html' as rec_macro %}
{% import 'macros/button-macro.html' as button_macro %}

{% macro render_name_header(name, current_user) %}
  <div class='name-header'>
    <p class='reckoner name-header-display'>{{name.user.username}}</p>
    {{button_macro.follow_button(name.user, current_user)}}
  </div><!--name-header-->
{% endmacro %}

{% macro initialize_followed_by(display, moment, current_user, Recommendation) %}
  {% if display.items|length != 0 %}
    {{ajax(display, moment, current_user, Recommendation)}}
  {% else %}
    <p>Nobody is following you! Post some Recs to get followers.</p>
  {% endif %}
  {% if display.pages != display.page %}
    <a><p id='ajax-recs' class='load-more'>Load More</p></a>
  {% endif %}
  <script src="{{url_for('static', filename='js/macros/rec.js')}}"></script>
{% endmacro %}

{% macro ajax(display, moment, current_user, Recommendation) %}
  {% for name in display.items %}
    {{render_name_header(name, current_user)}}
    {% set highlight = name.user.posts.filter(Recommendation.verification > 0)
        .order_by(Recommendation.timestamp.desc()).first() %}
    {% if highlight != None %}
      {{rec_macro.render_rec(highlight, moment, current_user)}}
    {% else %}
      <br/>
    {% endif %}
  {% endfor %}
{% endmacro %}